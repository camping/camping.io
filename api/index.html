<!DOCTYPE html>
<html>
<head>
  <title>Camping, the Reference</title>
	<link rel="stylesheet" href="rdoc.css" type="text/css" media="screen" />
  <script src="js/jquery.js" type="text/javascript"></script>
  <script src="js/camping.js" type="text/javascript"></script>
</head>
<body>
  <div id="menu">
    <ul id="links">
      <li><a href="/">front</a> | </li>
      <li><a href="book.html">book</a> | </li>
      <li><a href="http://wiki.github.com/camping/camping">wiki</a> | </li>
      <li><a href="http://github.com/camping/camping">code</a></li>
    </ul>
    <p id="version">Camping 2.1.414</p>
  </div>
  
  <div id="fullpage">
    <div class="page_shade">
    	<div class="page ref">
        <button id="expand_all">Expand All</button>
    	  <p class="header">Thu Aug 19 16:07:43 +0200 2010</p>
    	  <h1>Camping, the Reference</h1>
    	
    	 
    		<h2 id="class-Camping">
    		  <a href="#class-Camping">
    		  Module
    		  Camping
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <p>
If you&#8217;re new to <a href="#class-Camping">Camping</a>, you
should probably start by reading the first chapters of <a
href="file:book/01_introduction.html#toc">The Camping Book</a>.
</p>
<p>
Okay. So, the important thing to remember is that <tt><a
href="#M000028">Camping.goes</a> :Nuts</tt> copies the <a
href="#class-Camping">Camping</a> module into Nuts. This means that
you should never use any of these methods/classes on the <a
href="#class-Camping">Camping</a> module, but rather on your own
app. Here&#8217;s a short explanation on how <a
href="#class-Camping">Camping</a> is organized:
</p>
<ul>
<li><a href="#class-Camping-Controllers">Camping::Controllers</a> is
where your controllers live.

</li>
<li><a href="#class-Camping-Models">Camping::Models</a> is where your
models live.

</li>
<li><a href="#class-Camping-Views">Camping::Views</a> is where your
views live.

</li>
<li><a href="#class-Camping-Base">Camping::Base</a> is a module which
is included in all your controllers.

</li>
<li><a href="#class-Camping-Helpers">Camping::Helpers</a> is a module
with useful helpers, both for the controllers and the views. You should
fill this up with your own helpers.

</li>
</ul>
<p>
<a href="#class-Camping">Camping</a> also ships with:
</p>
<ul>
<li><a href="#class-Camping-Session">Camping::Session</a> adds states
to your app.

</li>
<li><a href="#class-Camping-Server">Camping::Server</a> starts up your
app in development.

</li>
<li><a href="#class-Camping-Reloader">Camping::Reloader</a>
automatically reloads your apps when a file has changed.

</li>
</ul>
<p>
More importantly, <a href="#class-Camping">Camping</a> also
installs The <a href="#class-Camping">Camping</a> <a
href="#class-Camping-Server">Server</a>, please see <a
href="#class-Camping-Server">Camping::Server</a>.
</p>
<hr size="1"></hr><h3>The <a href="#class-Camping">Camping</a> <a href="#class-Camping-Server">Server</a> (for development)</h3>
<p>
<a href="#class-Camping">Camping</a> includes a pretty nifty server
which is built for development. It follows these rules:
</p>
<ul>
<li>Load all <a href="#class-Camping">Camping</a> apps in a directory
or a file.

</li>
<li>Load new apps that appear in that directory or that file.

</li>
<li>Mount those apps according to their name. (e.g. Blog is mounted at /blog.)

</li>
<li>Run each app&#8217;s <tt>create</tt> method upon startup.

</li>
<li>Reload the app if its modification time changes.

</li>
<li>Reload the app if it requires any files under the same directory and one of
their modification times changes.

</li>
<li>Support the X-Sendfile header.

</li>
</ul>
<p>
Run it like this:
</p>
<pre>
  camping examples/        # Mounts all apps in that directory
  camping blog.rb          # Mounts Blog at /
</pre>
<p>
And visit <a href="http://localhost:3301">localhost:3301</a>/ in your
browser.
</p>

  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000029">
    		    <a href="#M000029">
    		    Public Class method:
    		    <strong>::call(e)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Ruby web servers use this method to enter the <a
href="#class-Camping">Camping</a> realm. The <tt>e</tt> argument is
the environment variables hash as per the Rack specification. And array
with [status, headers, body] is expected at the output.
</p>
<p>
See: <a
href="http://rack.rubyforge.org/doc/SPEC.html">rack.rubyforge.org/doc/SPEC.html</a>
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 609</span>
609:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">e</span>)
610:       <span class="ruby-constant">X</span>.<span class="ruby-constant">M</span>
611:       <span class="ruby-identifier">p</span> = <span class="ruby-identifier">e</span>[<span class="ruby-value str">'PATH_INFO'</span>] = <span class="ruby-constant">U</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">e</span>[<span class="ruby-value str">'PATH_INFO'</span>])
612:       <span class="ruby-identifier">k</span>,<span class="ruby-identifier">m</span>,<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>=<span class="ruby-constant">X</span>.<span class="ruby-constant">D</span> <span class="ruby-identifier">p</span>,<span class="ruby-identifier">e</span>[<span class="ruby-value str">'REQUEST_METHOD'</span>].<span class="ruby-identifier">downcase</span>,<span class="ruby-identifier">e</span>
613:       <span class="ruby-identifier">k</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">e</span>,<span class="ruby-identifier">m</span>).<span class="ruby-identifier">service</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>).<span class="ruby-identifier">to_a</span>
614:     <span class="ruby-keyword kw">rescue</span>
615:       <span class="ruby-identifier">r500</span>(<span class="ruby-identifier">:I</span>, <span class="ruby-identifier">k</span>, <span class="ruby-identifier">m</span>, <span class="ruby-identifier">$!</span>, <span class="ruby-identifier">:env</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>).<span class="ruby-identifier">to_a</span>
616:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000028">
    		    <a href="#M000028">
    		    Public Class method:
    		    <strong>::goes(m)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
When you are running many applications, you may want to create independent
modules for each <a href="#class-Camping">Camping</a> application.
Camping::goes defines a toplevel constant with the whole MVC rack inside:
</p>
<pre>
  require 'camping'
  Camping.goes :Nuts

  module Nuts::Controllers; ... end
  module Nuts::Models;      ... end
  module Nuts::Views;       ... end
</pre>
<p>
All the applications will be available in Camping::Apps.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 600</span>
600:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">goes</span>(<span class="ruby-identifier">m</span>)
601:       <span class="ruby-constant">Apps</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">eval</span>(<span class="ruby-constant">S</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/Camping/</span>,<span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_s</span>), <span class="ruby-constant">TOPLEVEL_BINDING</span>)
602:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000030">
    		    <a href="#M000030">
    		    Public Class method:
    		    <strong>::method_missing(m, c, *a)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
The <a href="#class-Camping">Camping</a> scriptable dispatcher. Any
unhandled method call to the app module will be sent to a controller class,
specified as an argument.
</p>
<pre>
  Blog.get(:Index)
  #=&gt; #&lt;Blog::Controllers::Index ... &gt;
</pre>
<p>
The controller object contains all the @cookies, @body, @headers, etc.
formulated by the response.
</p>
<p>
You can also feed environment variables and query variables as a hash, the
final argument.
</p>
<pre>
  Blog.post(:Login, :input =&gt; {'username' =&gt; 'admin', 'password' =&gt; 'camping'})
  #=&gt; #&lt;Blog::Controllers::Login @user=... &gt;

  Blog.get(:Info, :env =&gt; {'HTTP_HOST' =&gt; 'wagon'})
  #=&gt; #&lt;Blog::Controllers::Info @headers={'HTTP_HOST'=&gt;'wagon'} ...&gt;
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 636</span>
636:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">m</span>, <span class="ruby-identifier">c</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
637:       <span class="ruby-constant">X</span>.<span class="ruby-constant">M</span>
638:       <span class="ruby-identifier">h</span> = <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {}
639:       <span class="ruby-identifier">e</span> = <span class="ruby-constant">H</span>[<span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">MockRequest</span>.<span class="ruby-identifier">env_for</span>(<span class="ruby-value str">''</span>,<span class="ruby-identifier">h</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:env</span>)<span class="ruby-operator">||</span>{})]
640:       <span class="ruby-identifier">k</span> = <span class="ruby-constant">X</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">c</span>).<span class="ruby-identifier">new</span>(<span class="ruby-identifier">e</span>,<span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_s</span>)
641:       <span class="ruby-identifier">h</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{i}=&quot;</span>, <span class="ruby-identifier">v</span>) }
642:       <span class="ruby-identifier">k</span>.<span class="ruby-identifier">service</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
643:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000032">
    		    <a href="#M000032">
    		    Public Class method:
    		    <strong>::options()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
A hash where you can set different settings.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 657</span>
657:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">options</span>
658:       <span class="ruby-constant">O</span>
659:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000033">
    		    <a href="#M000033">
    		    Public Class method:
    		    <strong>::set(k, v)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Shortcut for setting options:
</p>
<pre>
  module Blog
    set :secret, &quot;Hello!&quot;
  end
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 666</span>
666:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>)
667:       <span class="ruby-constant">O</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
668:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000031">
    		    <a href="#M000031">
    		    Public Class method:
    		    <strong>::use(*a, &b)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Injects a middleware:
</p>
<pre>
  module Blog
    use Rack::MethodOverride
    use Rack::Session::Memcache, :key =&gt; &quot;session&quot;
  end
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 651</span>
651:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
652:       <span class="ruby-identifier">m</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">method</span>(<span class="ruby-identifier">:call</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
653:       <span class="ruby-identifier">meta_def</span>(<span class="ruby-identifier">:call</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">e</span>) }
654:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Base">
    		  <a href="#class-Camping-Base">
    		  Module
    		  Camping::Base
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <p>
<a href="#class-Camping-Base">Camping::Base</a> is built into each
controller by way of the generic routing class Camping::R. In some ways,
this class is trying to do too much, but it saves code for all the glue to
stay in one place. Forgivable, considering that it&#8217;s only really a
handful of methods and accessors.
</p>
<p>
Everything in this module is accessable inside your controllers.
</p>

  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000005">
    		    <a href="#M000005">
    		    Public Instance method:
    		    <strong>#lookup(n)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Finds a template, returning either:
</p>
<pre>
  false             # =&gt; Could not find template
  true              # =&gt; Found template in Views
  instance of Tilt  # =&gt; Found template in a file
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 250</span>
250:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lookup</span>(<span class="ruby-identifier">n</span>)
251:       <span class="ruby-constant">T</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_sym</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
252:         <span class="ruby-identifier">t</span> = <span class="ruby-constant">Views</span>.<span class="ruby-identifier">method_defined?</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">||</span>
253:           (<span class="ruby-identifier">f</span> = <span class="ruby-constant">Dir</span>[[<span class="ruby-constant">O</span>[<span class="ruby-identifier">:views</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;views&quot;</span>, <span class="ruby-node">&quot;#{n}.*&quot;</span>]<span class="ruby-operator">*</span><span class="ruby-value str">'/'</span>][<span class="ruby-value">0</span>]) <span class="ruby-operator">&amp;&amp;</span>
254:           <span class="ruby-constant">Template</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">f</span>, <span class="ruby-constant">O</span>[<span class="ruby-identifier">f</span>[<span class="ruby-regexp re">/\.(\w+)$/</span>, <span class="ruby-value">1</span>].<span class="ruby-identifier">to_sym</span>] <span class="ruby-operator">||</span> {})
255:         
256:         <span class="ruby-constant">O</span>[<span class="ruby-identifier">:dynamic_templates</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">:</span> <span class="ruby-constant">T</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">t</span>
257:       <span class="ruby-keyword kw">end</span>
258:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000007">
    		    <a href="#M000007">
    		    Public Instance method:
    		    <strong>#mab(&b)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
You can directly return HTML form your controller for quick debugging by
calling this method and pass some Markaby to it.
</p>
<pre>
  module Nuts::Controllers
    class Info
      def get; mab{ code @headers.inspect } end
    end
  end
</pre>
<p>
You can also pass true to use the :layout HTML wrapping method
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 293</span>
293:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mab</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
294:       (<span class="ruby-ivar">@mab</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Mab</span>.<span class="ruby-identifier">new</span>({},<span class="ruby-keyword kw">self</span>)).<span class="ruby-identifier">capture</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
295:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000008">
    		    <a href="#M000008">
    		    Public Instance method:
    		    <strong>#r(s, b, h = {})</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
A quick means of setting this controller&#8217;s status, body and headers
based on a Rack response:
</p>
<pre>
  r(302, 'Location' =&gt; self / &quot;/view/12&quot;, '')
  r(*another_app.call(@env))
</pre>
<p>
You can also switch the body and the header if you want:
</p>
<pre>
  r(404, &quot;Could not find page&quot;)
</pre>
<p>
See also: <a href="#M000010">r404</a>, <a
href="#M000011">r500</a> and <a href="#M000012">r501</a>
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 308</span>
308:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">r</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">b</span>, <span class="ruby-identifier">h</span> = {})
309:       <span class="ruby-identifier">b</span>, <span class="ruby-identifier">h</span> = <span class="ruby-identifier">h</span>, <span class="ruby-identifier">b</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">b</span>
310:       <span class="ruby-ivar">@status</span> = <span class="ruby-identifier">s</span>
311:       <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">h</span>)
312:       <span class="ruby-ivar">@body</span> = <span class="ruby-identifier">b</span>
313:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000010">
    		    <a href="#M000010">
    		    Public Instance method:
    		    <strong>#r404(p)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Called when a controller was not found. You can override this if you want
to customize the error page:
</p>
<pre>
  module Nuts
    def r404(path)
      @path = path
      render :not_found
    end
  end
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 342</span>
342:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">r404</span>(<span class="ruby-identifier">p</span>)
343:       <span class="ruby-constant">P</span> <span class="ruby-operator">%</span> <span class="ruby-node">&quot;#{p} not found&quot;</span>
344:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000011">
    		    <a href="#M000011">
    		    Public Instance method:
    		    <strong>#r500(k,m,e)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Called when an exception is raised. However, if there is a parse error in
<a href="#class-Camping">Camping</a> or in your application&#8217;s
source code, it will not be caught.
</p>
<p>
<tt>k</tt> is the controller class, <tt>m</tt> is the request method (GET,
POST, etc.) and <tt>e</tt> is the Exception which can be mined for useful
info.
</p>
<p>
Be default this simply re-raises the error so a Rack middleware can handle
it, but you are free to override it here:
</p>
<pre>
  module Nuts
    def r500(klass, method, exception)
      send_email_alert(klass, method, exception)
      render :server_error
    end
  end
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 361</span>
361:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">r500</span>(<span class="ruby-identifier">k</span>,<span class="ruby-identifier">m</span>,<span class="ruby-identifier">e</span>)
362:       <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
363:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000012">
    		    <a href="#M000012">
    		    Public Instance method:
    		    <strong>#r501(m)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Called if an undefined method is called on a controller, along with the
request method <tt>m</tt> (GET, POST, etc.)
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 367</span>
367:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">r501</span>(<span class="ruby-identifier">m</span>)
368:       <span class="ruby-constant">P</span> <span class="ruby-operator">%</span> <span class="ruby-node">&quot;#{m.upcase} not implemented&quot;</span>
369:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000009">
    		    <a href="#M000009">
    		    Public Instance method:
    		    <strong>#redirect(*a)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Formulate a redirect response: a 302 status with <tt>Location</tt> header
and a blank body. Uses <a href="#M000004">Helpers#URL</a> to build
the location from a controller route or path.
</p>
<p>
So, given a root of <tt><a
href="http://localhost:3301/articles">localhost:3301/articles</a></tt>:
</p>
<pre>
  redirect &quot;view/12&quot;  # redirects to &quot;//localhost:3301/articles/view/12&quot;
  redirect View, 12   # redirects to &quot;//localhost:3301/articles/view/12&quot;
</pre>
<p>
<b>NOTE:</b> This method doesn&#8217;t magically exit your methods and
redirect. You&#8217;ll need to <tt>return redirect(...)</tt> if this
isn&#8217;t the last statement in your code, or <tt>throw :halt</tt> if
it&#8217;s in a helper.
</p>
<p>
See: <a href="#class-Camping-Controllers">Controllers</a>
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 329</span>
329:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
330:       <span class="ruby-identifier">r</span>(<span class="ruby-value">302</span>,<span class="ruby-value str">''</span>,<span class="ruby-value str">'Location'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-constant">URL</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>).<span class="ruby-identifier">to_s</span>)
331:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000006">
    		    <a href="#M000006">
    		    Public Instance method:
    		    <strong>#render(v, *a, &b)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Display a view, calling it by its method name <tt>v</tt>. If a
<tt>layout</tt> method is found in <a
href="#class-Camping-Views">Camping::Views</a>, it will be used to
wrap the HTML.
</p>
<pre>
  module Nuts::Controllers
    class Show
      def get
        @posts = Post.find :all
        render :index
      end
    end
  end
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 272</span>
272:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>(<span class="ruby-identifier">v</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
273:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span> = <span class="ruby-identifier">lookup</span>(<span class="ruby-identifier">v</span>)
274:         <span class="ruby-identifier">o</span> = <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {}
275:         <span class="ruby-identifier">s</span> = (<span class="ruby-identifier">t</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">mab</span>{ <span class="ruby-identifier">send</span>(<span class="ruby-identifier">v</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>) } <span class="ruby-operator">:</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">render</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">o</span>[<span class="ruby-identifier">:locals</span>] <span class="ruby-operator">||</span> {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
276:         <span class="ruby-identifier">s</span> = <span class="ruby-identifier">render</span>(<span class="ruby-constant">L</span>, <span class="ruby-identifier">o</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-constant">L</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>)) { <span class="ruby-identifier">s</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">?_</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">o</span>[<span class="ruby-constant">L</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lookup</span>(<span class="ruby-constant">L</span>)
277:         <span class="ruby-identifier">s</span>
278:       <span class="ruby-keyword kw">else</span>
279:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Can't find template #{v}&quot;</span>
280:       <span class="ruby-keyword kw">end</span>
281:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000016">
    		    <a href="#M000016">
    		    Public Instance method:
    		    <strong>#service(*a)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
All requests pass through this method before going to the controller. Some
magic in <a href="#class-Camping">Camping</a> can be performed by
overriding this method.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 415</span>
415:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">service</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
416:       <span class="ruby-identifier">r</span> = <span class="ruby-identifier">catch</span>(<span class="ruby-identifier">:halt</span>){<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@method</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)}
417:       <span class="ruby-ivar">@body</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">r</span> 
418:       <span class="ruby-keyword kw">self</span>
419:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000013">
    		    <a href="#M000013">
    		    Public Instance method:
    		    <strong>#to_a()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Turn a controller into a Rack response. This is designed to be used to pipe
controllers into the <tt>r</tt> method. A great way to forward your
requests!
</p>
<pre>
  class Read &lt; '/(\d+)'
    def get(id)
      Post.find(id)
    rescue
      r *Blog.get(:NotFound, @headers.REQUEST_URI)
    end
  end
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 382</span>
382:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_a</span>
383:       <span class="ruby-ivar">@env</span>[<span class="ruby-value str">'rack.session'</span>] = <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@state</span>]
384:       <span class="ruby-identifier">r</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@body</span>, <span class="ruby-ivar">@status</span>, <span class="ruby-ivar">@headers</span>)
385:       <span class="ruby-ivar">@cookies</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
386:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@old_cookies</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">v</span>
387:         <span class="ruby-identifier">v</span> = { <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">v</span>, <span class="ruby-identifier">:path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span> <span class="ruby-operator">/</span> <span class="ruby-value str">&quot;/&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v</span>
388:         <span class="ruby-identifier">r</span>.<span class="ruby-identifier">set_cookie</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>)
389:       <span class="ruby-keyword kw">end</span>
390:       <span class="ruby-identifier">r</span>.<span class="ruby-identifier">to_a</span>
391:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Controllers">
    		  <a href="#class-Camping-Controllers">
    		  Module
    		  Camping::Controllers
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <p>
<a href="#class-Camping-Controllers">Controllers</a> receive the
requests and sends a response back to the client. A controller is simply a
class which must implement the HTTP methods it wants to accept:
</p>
<pre>
  module Nuts::Controllers
    class Index
      def get
        &quot;Hello World&quot;
      end
    end

    class Posts
      def post
        Post.create(@input)
        redirect Index
      end
    end
  end
</pre>
<h3>Defining a controller</h3>
<p>
There are two ways to define controllers: Just defining a class and let <a
href="#class-Camping">Camping</a> figure out the route, or add the
route explicitly using <a href="#M000021">R</a>.
</p>
<p>
If you don&#8217;t use <a href="#M000021">R</a>, <a
href="#class-Camping">Camping</a> will first split the controller
name up by words (HelloWorld => Hello and World). Then it would do the
following:
</p>
<ul>
<li>Replace Index with /

</li>
<li>Replace X with ([^/]+)

</li>
<li>Replace <a href="#class-Camping-Controllers#N">N</a> with (\d+)

</li>
<li>Everything else turns into lowercase

</li>
<li>Join the words with slashes

</li>
</ul>
<p>
Here&#8217;s a few examples:
</p>
<pre>
  Index   # =&gt; /
  PostN   # =&gt; /post/(\d+)
  PageX   # =&gt; /page/([^/]+)
  Pages   # =&gt; /pages
</pre>
<h3>The request</h3>
<p>
You have these variables which describes the request:
</p>
<ul>
<li>@env contains the environment as defined in <a
href="http://rack.rubyforge.org/doc/SPEC.html">rack.rubyforge.org/doc/SPEC.html</a>

</li>
<li>@request is Rack::Request.new(@env)

</li>
<li>@root is the path where the app is mounted

</li>
<li>@cookies is a hash with the cookies sent by the client

</li>
<li>@state is a hash with the sessions (see <a
href="#class-Camping-Session">Camping::Session</a>)

</li>
<li>@method is the HTTP method in lowercase

</li>
</ul>
<h3>The response</h3>
<p>
You can change these variables to your needs:
</p>
<ul>
<li>@status is the HTTP status (defaults to 200)

</li>
<li>@headers is a hash with the headers

</li>
<li>@body is the body (a string or something which responds to each)

</li>
<li>Any changes in @cookies and @state will also be sent to the client

</li>
</ul>
<p>
If you haven&#8217;t set @body, it will use the return value of the method:
</p>
<pre>
  module Nuts::Controllers
    class Index
      def get
        &quot;This is the body&quot;
      end
    end

    class Posts
      def get
        @body = &quot;Hello World!&quot;
        &quot;This is ignored&quot;
      end
    end
  end
</pre>

  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000025">
    		    <a href="#M000025">
    		    Public Class method:
    		    <strong>::D(p, m, e)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Dispatch routes to controller classes. For each class, routes are checked
for a match based on their order in the routing list given to
Controllers::R. If no routes were given, the dispatcher uses a slash
followed by the name of the controller lowercased.
</p>
<p>
<a href="#class-Camping-Controllers">Controllers</a> are searched
in this order:
</p>
<ul>
<li>Classes without routes, since they refer to a very specific URL.

</li>
<li>Classes with routes are searched in order of their creation.

</li>
</ul>
<p>
So, define your catch-all controllers last.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 545</span>
545:       <span class="ruby-keyword kw">def</span> <span class="ruby-constant">D</span>(<span class="ruby-identifier">p</span>, <span class="ruby-identifier">m</span>, <span class="ruby-identifier">e</span>)
546:         <span class="ruby-identifier">p</span> = <span class="ruby-value str">'/'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>[<span class="ruby-value">0</span>]
547:         <span class="ruby-identifier">r</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
548:           <span class="ruby-identifier">k</span>.<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
549:             <span class="ruby-keyword kw">return</span> (<span class="ruby-identifier">k</span>.<span class="ruby-identifier">method_defined?</span>(<span class="ruby-identifier">m</span>)) <span class="ruby-operator">?</span>
550:               [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">m</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">$~</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]] <span class="ruby-operator">:</span> [<span class="ruby-constant">I</span>, <span class="ruby-value str">'r501'</span>, <span class="ruby-identifier">m</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/^#{x}\/?$/</span>
551:           }
552:         }
553:         [<span class="ruby-constant">I</span>, <span class="ruby-value str">'r404'</span>, <span class="ruby-identifier">p</span>]
554:       <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000026">
    		    <a href="#M000026">
    		    Public Class method:
    		    <strong>::M()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
The route maker, this is called by <a
href="#class-Camping">Camping</a> internally, you shouldn&#8217;t
need to call it.
</p>
<p>
Still, it&#8217;s worth know what this method does. Since Ruby
doesn&#8217;t keep track of class creation order, we&#8217;re keeping an
internal list of the controllers which inherit from R(). This method goes
through and adds all the remaining routes to the beginning of the list and
ensures all the controllers have the right mixins.
</p>
<p>
Anyway, if you are calling the URI dispatcher from outside of a <a
href="#class-Camping">Camping</a> server, you&#8217;ll definitely
need to call this to set things up. Don&#8217;t call it too early though.
Any controllers added after this method is called won&#8217;t work properly
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 570</span>
570:       <span class="ruby-keyword kw">def</span> <span class="ruby-constant">M</span>
571:         <span class="ruby-keyword kw">def</span> <span class="ruby-constant">M</span> <span class="ruby-comment cmt">#:nodoc:</span>
572:         <span class="ruby-keyword kw">end</span>
573:         <span class="ruby-identifier">constants</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
574:           <span class="ruby-identifier">k</span> = <span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">c</span>)
575:           <span class="ruby-identifier">k</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:include</span>,<span class="ruby-constant">C</span>,<span class="ruby-constant">X</span>,<span class="ruby-constant">Base</span>,<span class="ruby-constant">Helpers</span>,<span class="ruby-constant">Models</span>
576:           <span class="ruby-ivar">@r</span>=[<span class="ruby-identifier">k</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">r</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span><span class="ruby-operator">-</span>[<span class="ruby-identifier">k</span>]<span class="ruby-operator">==</span><span class="ruby-identifier">r</span>
577:           <span class="ruby-identifier">k</span>.<span class="ruby-identifier">meta_def</span>(<span class="ruby-identifier">:urls</span>){[<span class="ruby-node">&quot;/#{c.to_s.scan(/.[^A-Z]*/).map(&amp;N.method(:[]))*'/'}&quot;</span>]}<span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">k</span>.<span class="ruby-identifier">respond_to?</span><span class="ruby-identifier">:urls</span>
578:         }
579:       <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000021">
    		    <a href="#M000021">
    		    Public Class method:
    		    <strong>::R(*u)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Add routes to a controller class by piling them into the <a
href="#M000021">R</a> method.
</p>
<p>
The route is a regexp which will match the request path. Anything enclosed
in parenthesis will be sent to the method as arguments.
</p>
<pre>
  module Camping::Controllers
    class Edit &lt; R '/edit/(\d+)', '/new'
      def get(id)
        if id   # edit
        else    # new
        end
      end
    end
  end
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 526</span>
526:       <span class="ruby-keyword kw">def</span> <span class="ruby-constant">R</span> <span class="ruby-operator">*</span><span class="ruby-identifier">u</span>
527:         <span class="ruby-identifier">r</span>=<span class="ruby-ivar">@r</span>
528:         <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span> {
529:           <span class="ruby-identifier">meta_def</span>(<span class="ruby-identifier">:urls</span>){<span class="ruby-identifier">u</span>}
530:           <span class="ruby-identifier">meta_def</span>(<span class="ruby-identifier">:inherited</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">x</span>}
531:         }
532:       <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-H">
    		  <a href="#class-Camping-H">
    		  Class
    		  Camping::H
    		  
    		    &lt;
            
              Hash
            
          
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <p>
An object-like Hash. All <a href="#class-Camping">Camping</a> query
string and cookie variables are loaded as this.
</p>
<p>
To access the query string, for instance, use the <tt>@input</tt> variable.
</p>
<pre>
  module Blog::Controllers
    class Index &lt; R '/'
      def get
        if (page = @input.page.to_i) &gt; 0
          page -= 1
        end
        @posts = Post.all, :offset =&gt; page * 20, :limit =&gt; 20
        render :index
      end
    end
  end
</pre>
<p>
In the above example if you visit <tt>/?page=2</tt>, you&#8217;ll get the
second page of twenty posts. You can also use <tt>@input['page']</tt> to
get the value for the <tt>page</tt> query variable.
</p>

  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000001">
    		    <a href="#M000001">
    		    Public Instance method:
    		    <strong>#method_missing(m,*a)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Gets or sets keys in the hash.
</p>
<pre>
  @cookies.my_favorite = :macadamian
  @cookies.my_favorite
  =&gt; :macadamian
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
    <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">m</span>,<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
81:         <span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">=~</span><span class="ruby-regexp re">/=$/</span><span class="ruby-operator">?</span><span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">$`</span>]=<span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">:</span><span class="ruby-identifier">a</span><span class="ruby-operator">==</span>[]<span class="ruby-operator">?</span><span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_s</span>]<span class="ruby-operator">:</span><span class="ruby-keyword kw">super</span>
82:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Helpers">
    		  <a href="#class-Camping-Helpers">
    		  Module
    		  Camping::Helpers
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <p>
<a href="#class-Camping-Helpers">Helpers</a> contains methods
available in your controllers and views. You may add methods of your own to
this module, including many helper methods from Rails. This is analogous to
Rails&#8217; <tt>ApplicationHelper</tt> module.
</p>
<h3>Using ActionPack <a href="#class-Camping-Helpers">Helpers</a></h3>
<p>
If you&#8217;d like to include helpers from Rails&#8217; modules,
you&#8217;ll need to look up the helper module in the Rails documentation
at <a href="http://api.rubyonrails.org/.">api.rubyonrails.org/.</a>
</p>
<p>
For example, if you look up the <tt>ActionView::Helpers::FormTagHelper</tt>
class, you&#8217;ll find that it&#8217;s loaded from the
<tt>action_view/helpers/form_tag_helper.rb</tt> file. You&#8217;ll need to
have the ActionPack gem installed for this to work.
</p>
<p>
Often the helpers depends on other helpers, so you would have to look up
the dependencies too. <tt>FormTagHelper</tt> for instance required the
<tt>content_tag</tt> provided by <tt>TagHelper</tt>.
</p>
<pre>
  require 'action_view/helpers/form_tag_helper'

  module Nuts::Helpers
    include ActionView::Helpers::TagHelper
    include ActionView::Helpers::FormTagHelper
  end
</pre>
<h3>Return a response immediately</h3>
<p>
If you need to return a response inside a helper, you can use <tt>throw
:halt</tt>.
</p>
<pre>
  module Nuts::Helpers
    def requires_login!
      unless @state.user_id
        redirect Login
        throw :halt
      end
    end
  end

  module Nuts::Controllers
    class Admin
      def get
        requires_login!
        &quot;Never gets here unless you're logged in&quot;
      end
    end
  end
</pre>

  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000003">
    		    <a href="#M000003">
    		    Public Instance method:
    		    <strong>#/(p)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Simply builds a complete path from a path <tt>p</tt> within the app. If
your application is mounted at <tt>/blog</tt>:
</p>
<pre>
  self / &quot;/view/1&quot;    #=&gt; &quot;/blog/view/1&quot;
  self / &quot;styles.css&quot; #=&gt; &quot;styles.css&quot;
  self / R(Edit, 1)   #=&gt; &quot;/blog/edit/1&quot;
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 201</span>
201:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">/</span>(<span class="ruby-identifier">p</span>); <span class="ruby-identifier">p</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?/</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@root</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000002">
    		    <a href="#M000002">
    		    Public Instance method:
    		    <strong>#R(c,*g)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
From inside your controllers and views, you will often need to figure out
the route used to get to a certain controller <tt>c</tt>. Pass the
controller class and any arguments into the <a
href="#M000002">R</a> method, a string containing the route will be
returned to you.
</p>
<p>
Assuming you have a specific route in an edit controller:
</p>
<pre>
  class Edit &lt; R '/edit/(\d+)'
</pre>
<p>
A specific route to the Edit controller can be built with:
</p>
<pre>
  R(Edit, 1)
</pre>
<p>
Which outputs: <tt>/edit/1</tt>.
</p>
<p>
If a controller has many routes, the route will be selected if it is the
first in the routing list to have the right number of arguments.
</p>
<h2>Using <a href="#M000002">R</a> in the View</h2>
<p>
Keep in mind that this route doesn&#8217;t include the root path. You will
need to use <tt>/</tt> (the slash method above) in your controllers. Or, go
ahead and use the <a href="#M000004">Helpers#URL</a> method to
build a complete <a href="#M000004">URL</a> for a route.
</p>
<p>
However, in your views, the :href, :src and :action attributes
automatically pass through the slash method, so you are encouraged to use
<tt>R</tt> or <tt>URL</tt> in your views.
</p>
<pre>
 module Nuts::Views
   def menu
     div.menu! do
       a 'Home', :href =&gt; URL()
       a 'Profile', :href =&gt; &quot;/profile&quot;
       a 'Logout', :href =&gt; R(Logout)
       a 'Google', :href =&gt; 'http://google.com'
     end
   end
 end
</pre>
<p>
Let&#8217;s say the above example takes place inside an application mounted
at <tt><a href="http://localhost:3301/frodo">localhost:3301/frodo</a></tt>
and that a controller named <tt>Logout</tt> is assigned to route
<tt>/logout</tt>. The HTML will come out as:
</p>
<pre>
  &lt;div id=&quot;menu&quot;&gt;
    &lt;a href=&quot;http://localhost:3301/frodo/&quot;&gt;Home&lt;/a&gt;
    &lt;a href=&quot;/frodo/profile&quot;&gt;Profile&lt;/a&gt;
    &lt;a href=&quot;/frodo/logout&quot;&gt;Logout&lt;/a&gt;
    &lt;a href=&quot;http://google.com&quot;&gt;Google&lt;/a&gt;
  &lt;/div&gt;
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 183</span>
183:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">R</span>(<span class="ruby-identifier">c</span>,<span class="ruby-operator">*</span><span class="ruby-identifier">g</span>)
184:       <span class="ruby-identifier">p</span>,<span class="ruby-identifier">h</span>=<span class="ruby-regexp re">/\(.+?\)/</span>,<span class="ruby-identifier">g</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-constant">Hash</span>)
185:       <span class="ruby-identifier">g</span><span class="ruby-operator">-=</span><span class="ruby-identifier">h</span>
186:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;bad route&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">u</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
187:         <span class="ruby-keyword kw">break</span> <span class="ruby-identifier">x</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">p</span>).<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&amp;&amp;</span> 
188:           <span class="ruby-node">/^#{x}\/?$/</span> <span class="ruby-operator">=~</span> (<span class="ruby-identifier">x</span>=<span class="ruby-identifier">g</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-identifier">x</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
189:             <span class="ruby-identifier">x</span>.<span class="ruby-identifier">sub</span> <span class="ruby-identifier">p</span>,<span class="ruby-constant">U</span>.<span class="ruby-identifier">escape</span>((<span class="ruby-identifier">a</span>.<span class="ruby-identifier">to_param</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">a</span>))}.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\\(.)/</span>){<span class="ruby-identifier">$1</span>})
190:       }
191:       <span class="ruby-identifier">h</span>.<span class="ruby-identifier">any?</span><span class="ruby-value">? </span><span class="ruby-identifier">u</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;?&quot;</span><span class="ruby-operator">+</span><span class="ruby-constant">U</span>.<span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">h</span>[<span class="ruby-value">0</span>]) <span class="ruby-operator">:</span> <span class="ruby-identifier">u</span>
192:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000004">
    		    <a href="#M000004">
    		    Public Instance method:
    		    <strong>#URL(c='/',*a)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Builds a <a href="#M000004">URL</a> route to a controller or a
path, returning a URI object. This way you&#8217;ll get the hostname and
the port number, a complete <a href="#M000004">URL</a>.
</p>
<p>
You can use this to grab URLs for controllers using the R-style syntax. So,
if your application is mounted at <tt><a
href="http://test.ing/blog/">test.ing/blog/</a></tt> and you have a View
controller which routes as <tt><a href="#M000002">R</a>
'/view/(d+)'</tt>:
</p>
<pre>
  URL(View, @post.id)    #=&gt; #&lt;URL:http://test.ing/blog/view/12&gt;
</pre>
<p>
Or you can use the direct path:
</p>
<pre>
  self.URL               #=&gt; #&lt;URL:http://test.ing/blog/&gt;
  self.URL + &quot;view/12&quot;   #=&gt; #&lt;URL:http://test.ing/blog/view/12&gt;
  URL(&quot;/view/12&quot;)        #=&gt; #&lt;URL:http://test.ing/blog/view/12&gt;
</pre>
<p>
It&#8217;s okay to pass <a href="#M000004">URL</a> strings through
this method as well:
</p>
<pre>
  URL(&quot;http://google.com&quot;)  #=&gt; #&lt;URL:http://google.com&gt;
</pre>
<p>
Any string which doesn&#8217;t begin with a slash will pass through
unscathed.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping-unabridged.rb, line 224</span>
224:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">URL</span> <span class="ruby-identifier">c</span>=<span class="ruby-value str">'/'</span>,<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>
225:       <span class="ruby-identifier">c</span> = <span class="ruby-constant">R</span>(<span class="ruby-identifier">c</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">a</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:urls</span>
226:       <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">self</span><span class="ruby-operator">/</span><span class="ruby-identifier">c</span>
227:       <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">url</span>[<span class="ruby-regexp re">/.{8,}?(?=\/)/</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">c</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">==</span><span class="ruby-value">?/</span>
228:       <span class="ruby-constant">URI</span>(<span class="ruby-identifier">c</span>)
229:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Models">
    		  <a href="#class-Camping-Models">
    		  Module
    		  Camping::Models
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <p>
<a href="#class-Camping-Models">Models</a> is an empty Ruby module
for housing model classes derived from ActiveRecord::Base. As a shortcut,
you may derive from <a href="#class-Camping-Models#Base">Base</a>
which is an alias for ActiveRecord::Base.
</p>
<pre>
  module Camping::Models
    class Post &lt; Base; belongs_to :user end
    class User &lt; Base; has_many :posts end
  end
</pre>
<h3>Where <a href="#class-Camping-Models">Models</a> are Used</h3>
<p>
<a href="#class-Camping-Models">Models</a> are used in your
controller classes. However, if your model class name conflicts with a
controller class name, you will need to refer to it using the <a
href="#class-Camping-Models">Models</a> module.
</p>
<pre>
  module Camping::Controllers
    class Post &lt; R '/post/(\d+)'
      def get(post_id)
        @post = Models::Post.find post_id
        render :index
      end
    end
  end
</pre>
<p>
<a href="#class-Camping-Models">Models</a> cannot be referred to in
<a href="#class-Camping-Views">Views</a> at this time.
</p>

  			  
    		  <h3>Methods</h3>
    		
        </div>
       
    		<h2 id="class-Camping-Models-Base">
    		  <a href="#class-Camping-Models-Base">
    		  Module
    		  Camping::Models::Base
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  
  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000000">
    		    <a href="#M000000">
    		    Public Class method:
    		    <strong>::table_name_prefix()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
The default prefix for <a href="#class-Camping">Camping</a> model
classes is the topmost module name lowercase and followed with an
underscore.
</p>
<pre>
  Tepee::Models::Page.table_name_prefix
    #=&gt; &quot;tepee_pages&quot;
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
    <span class="ruby-comment cmt"># File lib/camping/ar.rb, line 66</span>
66:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span>
67:         <span class="ruby-node">&quot;#{name[/\w+/]}_&quot;</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">/^(#{A}|camping)_/i</span>,<span class="ruby-value str">''</span>)
68:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Reloader">
    		  <a href="#class-Camping-Reloader">
    		  Class
    		  Camping::Reloader
    		  
    		    &lt;
            
              Object
            
          
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <h3>The <a href="#class-Camping">Camping</a> <a href="#class-Camping-Reloader">Reloader</a></h3>
<p>
<a href="#class-Camping">Camping</a> apps are generally small and
predictable. Many <a href="#class-Camping">Camping</a> apps are
contained within a single file. Larger apps are split into a handful of
other Ruby libraries within the same directory.
</p>
<p>
Since <a href="#class-Camping">Camping</a> apps (and their
dependencies) are loaded with Ruby&#8217;s require method, there is a
record of them in $LOADED_FEATURES. Which leaves a perfect space for this
class to manage auto-reloading an app if any of its immediate dependencies
changes.
</p>
<h3>Wrapping Your Apps</h3>
<p>
Since bin/camping and the <a
href="#class-Camping-Server">Camping::Server</a> class already use
the <a href="#class-Camping-Reloader">Reloader</a>, you probably
don&#8217;t need to hack it on your own. But, if you&#8217;re rolling your
own situation, here&#8217;s how.
</p>
<p>
Rather than this:
</p>
<pre>
  require 'yourapp'
</pre>
<p>
Use this:
</p>
<pre>
  require 'camping/reloader'
  reloader = Camping::Reloader.new('/path/to/yourapp.rb')
  blog = reloader.apps[:Blog]
  wiki = reloader.apps[:Wiki]
</pre>
<p>
The <tt>blog</tt> and <tt>wiki</tt> objects will behave exactly like your
Blog and Wiki, but they will update themselves if yourapp.rb changes.
</p>
<p>
You can also give <a href="#class-Camping-Reloader">Reloader</a>
more than one script.
</p>

  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000017">
    		    <a href="#M000017">
    		    Public Class method:
    		    <strong>::new(*scripts)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Creates the reloader, assigns a <tt>script</tt> to it and initially loads
the application. Pass in the full path to the script, otherwise the script
will be loaded relative to the current working directory.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/reloader.rb, line 135</span>
135:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">scripts</span>)
136:       <span class="ruby-ivar">@scripts</span> = []
137:       <span class="ruby-ivar">@apps</span> = {}
138:       <span class="ruby-identifier">update</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">scripts</span>)
139:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000022">
    		    <a href="#M000022">
    		    Public Instance method:
    		    <strong>#clear()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Removes all the scripts from the reloader.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/reloader.rb, line 162</span>
162:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear</span>
163:       <span class="ruby-ivar">@scripts</span> = []
164:       <span class="ruby-ivar">@apps</span> = {}
165:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000019">
    		    <a href="#M000019">
    		    Public Instance method:
    		    <strong>#on_reload(&blk)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/reloader.rb, line 141</span>
141:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">on_reload</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>)
142:       <span class="ruby-ivar">@callback</span> = <span class="ruby-identifier">blk</span>
143:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000024">
    		    <a href="#M000024">
    		    Public Instance method:
    		    <strong>#reload!()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Simply calls reload! on all the Script objects.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/reloader.rb, line 177</span>
177:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reload!</span>
178:       <span class="ruby-ivar">@apps</span> = {}
179:       <span class="ruby-ivar">@scripts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">script</span><span class="ruby-operator">|</span>
180:         <span class="ruby-identifier">script</span>.<span class="ruby-identifier">reload!</span>
181:         <span class="ruby-ivar">@apps</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">script</span>.<span class="ruby-identifier">apps</span>)
182:       <span class="ruby-keyword kw">end</span>
183:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000023">
    		    <a href="#M000023">
    		    Public Instance method:
    		    <strong>#script(app)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Returns the script which provided the given app.
</p>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/reloader.rb, line 168</span>
168:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">script</span>(<span class="ruby-identifier">app</span>)
169:       <span class="ruby-ivar">@scripts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">script</span><span class="ruby-operator">|</span>
170:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">script</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">script</span>.<span class="ruby-identifier">apps</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">app</span>)
171:       <span class="ruby-keyword kw">end</span>
172:       
173:       <span class="ruby-keyword kw">false</span>
174:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000020">
    		    <a href="#M000020">
    		    Public Instance method:
    		    <strong>#update(*scripts)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    <p>
Updates the reloader to only use the scripts provided:
</p>
<pre>
  reloader.update(&quot;examples/blog.rb&quot;, &quot;examples/wiki.rb&quot;)
</pre>

            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/reloader.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">scripts</span>)
149:       <span class="ruby-identifier">old_scripts</span> = <span class="ruby-ivar">@scripts</span>.<span class="ruby-identifier">dup</span>
150:       <span class="ruby-identifier">clear</span>
151:       
152:       <span class="ruby-ivar">@scripts</span> = <span class="ruby-identifier">scripts</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">script</span><span class="ruby-operator">|</span>
153:         <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">script</span>)
154:         <span class="ruby-identifier">old_scripts</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">file</span> } <span class="ruby-keyword kw">or</span>
155:         <span class="ruby-constant">Script</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">script</span>, <span class="ruby-ivar">@callback</span>)
156:       <span class="ruby-keyword kw">end</span>
157:       
158:       <span class="ruby-identifier">reload!</span>
159:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Server">
    		  <a href="#class-Camping-Server">
    		  Class
    		  Camping::Server
    		  
    		    &lt;
            
              Rack::Server
            
          
          </a>
    		</h2>
    		
    		<div class="mod">
  			  
  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000035">
    		    <a href="#M000035">
    		    Public Class method:
    		    <strong>::new(*)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 98</span>
 98:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span>)
 99:       <span class="ruby-keyword kw">super</span>
100:       <span class="ruby-ivar">@reloader</span> = <span class="ruby-constant">Camping</span><span class="ruby-operator">::</span><span class="ruby-constant">Reloader</span>.<span class="ruby-identifier">new</span>
101:       <span class="ruby-ivar">@reloader</span>.<span class="ruby-identifier">on_reload</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">app</span><span class="ruby-operator">|</span>
102:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">app</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:dynamic_templates</span>)
103:                       <span class="ruby-identifier">app</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:dynamic_templates</span>] = <span class="ruby-keyword kw">true</span>
104:               <span class="ruby-keyword kw">end</span>
105:               
106:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Camping</span><span class="ruby-operator">::</span><span class="ruby-constant">Models</span>.<span class="ruby-identifier">autoload?</span>(<span class="ruby-identifier">:Base</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:database</span>]
107:           <span class="ruby-constant">Camping</span><span class="ruby-operator">::</span><span class="ruby-constant">Models</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">establish_connection</span>(
108:             <span class="ruby-identifier">:adapter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'sqlite3'</span>,
109:             <span class="ruby-identifier">:database</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:database</span>]
110:           )
111:         <span class="ruby-keyword kw">end</span>
112:       <span class="ruby-keyword kw">end</span>
113:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000043">
    		    <a href="#M000043">
    		    Public Instance method:
    		    <strong>#app()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 164</span>
164:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">app</span>
165:       <span class="ruby-keyword kw">self</span>
166:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000044">
    		    <a href="#M000044">
    		    Public Instance method:
    		    <strong>#call(env)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 168</span>
168:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
169:       <span class="ruby-identifier">reload!</span>
170:       <span class="ruby-identifier">apps</span> = <span class="ruby-ivar">@reloader</span>.<span class="ruby-identifier">apps</span>
171: 
172:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">apps</span>.<span class="ruby-identifier">length</span>
173:       <span class="ruby-keyword kw">when</span> <span class="ruby-value">0</span>
174:         <span class="ruby-identifier">index_page</span>(<span class="ruby-identifier">apps</span>)
175:       <span class="ruby-keyword kw">when</span> <span class="ruby-value">1</span>
176:         <span class="ruby-identifier">apps</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
177:       <span class="ruby-keyword kw">else</span>
178:         <span class="ruby-identifier">apps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">app</span><span class="ruby-operator">|</span>
179:           <span class="ruby-identifier">mount</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
180:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;PATH_INFO&quot;</span>]
181:           <span class="ruby-keyword kw">when</span> <span class="ruby-node">%r{^/#{mount}}</span>
182:             <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;SCRIPT_NAME&quot;</span>] = <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;SCRIPT_NAME&quot;</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">$&amp;</span>
183:             <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;PATH_INFO&quot;</span>] = <span class="ruby-identifier">$'</span>
184:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
185:           <span class="ruby-keyword kw">when</span> <span class="ruby-node">%r{^/code/#{mount}}</span>
186:             <span class="ruby-keyword kw">return</span> [<span class="ruby-value">200</span>, {<span class="ruby-value str">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'text/plain'</span>, <span class="ruby-value str">'X-Sendfile'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@reloader</span>.<span class="ruby-identifier">script</span>(<span class="ruby-identifier">app</span>).<span class="ruby-identifier">file</span>}, []]
187:           <span class="ruby-keyword kw">end</span>
188:         <span class="ruby-keyword kw">end</span>
189:         
190:         <span class="ruby-identifier">index_page</span>(<span class="ruby-identifier">apps</span>)
191:       <span class="ruby-keyword kw">end</span>
192:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000038">
    		    <a href="#M000038">
    		    Public Instance method:
    		    <strong>#default_options()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 119</span>
119:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_options</span>
120:       <span class="ruby-keyword kw">super</span>.<span class="ruby-identifier">merge</span>({
121:         <span class="ruby-identifier">:Port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3301</span>,
122:         <span class="ruby-identifier">:database</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Options</span><span class="ruby-operator">::</span><span class="ruby-constant">DB</span>
123:       })
124:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000041">
    		    <a href="#M000041">
    		    Public Instance method:
    		    <strong>#find_scripts()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_scripts</span>
149:       <span class="ruby-identifier">scripts</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:scripts</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
150:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">path</span>)
151:           <span class="ruby-identifier">path</span>
152:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">path</span>)
153:           <span class="ruby-constant">Dir</span>[<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-value str">'*.rb'</span>)]
154:         <span class="ruby-keyword kw">end</span>
155:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
156:           
157:       <span class="ruby-ivar">@reloader</span>.<span class="ruby-identifier">update</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">scripts</span>)
158:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000045">
    		    <a href="#M000045">
    		    Public Instance method:
    		    <strong>#index_page(apps)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 194</span>
194:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index_page</span>(<span class="ruby-identifier">apps</span>)
195:       [<span class="ruby-value">200</span>, {<span class="ruby-value str">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'text/html'</span>}, [<span class="ruby-constant">TEMPLATE</span>.<span class="ruby-identifier">result</span>(<span class="ruby-identifier">binding</span>)]]
196:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000039">
    		    <a href="#M000039">
    		    Public Instance method:
    		    <strong>#middleware()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 126</span>
126:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">middleware</span>
127:       <span class="ruby-identifier">h</span> = <span class="ruby-keyword kw">super</span>
128:       <span class="ruby-identifier">h</span>[<span class="ruby-value str">&quot;development&quot;</span>].<span class="ruby-identifier">unshift</span> [<span class="ruby-constant">XSendfile</span>]
129:       <span class="ruby-identifier">h</span>
130:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000037">
    		    <a href="#M000037">
    		    Public Instance method:
    		    <strong>#opt_parser()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 115</span>
115:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">opt_parser</span>
116:       <span class="ruby-constant">Options</span>.<span class="ruby-identifier">new</span>
117:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000042">
    		    <a href="#M000042">
    		    Public Instance method:
    		    <strong>#reload!()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reload!</span>
161:       <span class="ruby-identifier">find_scripts</span>
162:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000040">
    		    <a href="#M000040">
    		    Public Instance method:
    		    <strong>#start()</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start</span>
133:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:server</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;console&quot;</span>
134:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;** Starting console&quot;</span>
135:         <span class="ruby-identifier">reload!</span>
136:         <span class="ruby-identifier">this</span> = <span class="ruby-keyword kw">self</span>
137:         <span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;self&quot;</span>, <span class="ruby-constant">TOPLEVEL_BINDING</span>).<span class="ruby-identifier">meta_def</span>(<span class="ruby-identifier">:reload!</span>) { <span class="ruby-identifier">this</span>.<span class="ruby-identifier">reload!</span>; <span class="ruby-keyword kw">nil</span> }
138:         <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">clear</span>
139:         <span class="ruby-constant">IRB</span>.<span class="ruby-identifier">start</span>
140:         <span class="ruby-identifier">exit</span>
141:       <span class="ruby-keyword kw">else</span>
142:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">name</span>[<span class="ruby-regexp re">/\w+$/</span>]
143:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;** Starting #{name} on #{options[:Host]}:#{options[:Port]}&quot;</span>
144:         <span class="ruby-keyword kw">super</span>
145:       <span class="ruby-keyword kw">end</span>
146:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Server-Options">
    		  <a href="#class-Camping-Server-Options">
    		  Class
    		  Camping::Server::Options
    		  
    		    &lt;
            
              Object
            
          
          </a>
    		</h2>
    		
    		<div class="mod">
  			  
  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000034">
    		    <a href="#M000034">
    		    Public Instance method:
    		    <strong>#parse!(args)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
    <span class="ruby-comment cmt"># File lib/camping/server.rb, line 42</span>
42:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse!</span>(<span class="ruby-identifier">args</span>)
43:         <span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">dup</span>
44:         <span class="ruby-identifier">options</span> = {}
45:         
46:         <span class="ruby-identifier">opt_parser</span> = <span class="ruby-constant">OptionParser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-value">24</span>, <span class="ruby-value str">'  '</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>
47:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">banner</span> = <span class="ruby-value str">&quot;Usage: camping app1.rb app2.rb...&quot;</span>
48:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">define_head</span> <span class="ruby-node">&quot;#{File.basename($0)}, the microframework ON-button for ruby #{RUBY_VERSION} (#{RUBY_RELEASE_DATE}) [#{RUBY_PLATFORM}]&quot;</span>
49:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
50:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Specific options:&quot;</span>
51:           
52:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-h&quot;</span>, <span class="ruby-value str">&quot;--host HOSTNAME&quot;</span>,
53:           <span class="ruby-value str">&quot;Host for web server to bind to (default is all IPs)&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:Host</span>] = <span class="ruby-identifier">v</span> }
54:           
55:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-p&quot;</span>, <span class="ruby-value str">&quot;--port NUM&quot;</span>,
56:           <span class="ruby-value str">&quot;Port for web server (defaults to 3301)&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:Port</span>] = <span class="ruby-identifier">v</span> }
57:           
58:           <span class="ruby-identifier">db</span> = <span class="ruby-constant">DB</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-constant">HOME</span>, <span class="ruby-value str">'~/'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">DB</span>
59:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-d&quot;</span>, <span class="ruby-value str">&quot;--database FILE&quot;</span>,
60:           <span class="ruby-node">&quot;SQLite3 database path (defaults to #{db ? db : '&lt;none&gt;'})&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">db_path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:database</span>] = <span class="ruby-identifier">db_path</span> }
61:           
62:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-C&quot;</span>, <span class="ruby-value str">&quot;--console&quot;</span>,
63:           <span class="ruby-value str">&quot;Run in console mode with IRB&quot;</span>) { <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:server</span>] = <span class="ruby-value str">&quot;console&quot;</span> }
64:           
65:           <span class="ruby-identifier">server_list</span> = [<span class="ruby-value str">&quot;mongrel&quot;</span>, <span class="ruby-value str">&quot;webrick&quot;</span>, <span class="ruby-value str">&quot;console&quot;</span>]
66:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-s&quot;</span>, <span class="ruby-value str">&quot;--server NAME&quot;</span>,
67:           <span class="ruby-node">&quot;Server to force (#{server_list.join(', ')})&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:server</span>] = <span class="ruby-identifier">v</span> }
68: 
69:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
70:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Common options:&quot;</span>
71:           
72:           <span class="ruby-comment cmt"># No argument, shows at tail.  This will print an options summary.</span>
73:           <span class="ruby-comment cmt"># Try it and see!</span>
74:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">&quot;-?&quot;</span>, <span class="ruby-value str">&quot;--help&quot;</span>, <span class="ruby-value str">&quot;Show this message&quot;</span>) <span class="ruby-keyword kw">do</span>
75:             <span class="ruby-identifier">puts</span> <span class="ruby-identifier">opts</span>
76:             <span class="ruby-identifier">exit</span>
77:           <span class="ruby-keyword kw">end</span>
78: 
79:           <span class="ruby-comment cmt"># Another typical switch to print the version.</span>
80:           <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">&quot;-v&quot;</span>, <span class="ruby-value str">&quot;--version&quot;</span>, <span class="ruby-value str">&quot;Show version&quot;</span>) <span class="ruby-keyword kw">do</span>
81:             <span class="ruby-identifier">puts</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>[<span class="ruby-value str">'camping'</span>].<span class="ruby-identifier">version</span>
82:             <span class="ruby-identifier">exit</span>
83:           <span class="ruby-keyword kw">end</span>
84:         <span class="ruby-keyword kw">end</span>
85:         
86:         <span class="ruby-identifier">opt_parser</span>.<span class="ruby-identifier">parse!</span>(<span class="ruby-identifier">args</span>)
87:         
88:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
89:           <span class="ruby-identifier">puts</span> <span class="ruby-identifier">opt_parser</span>
90:           <span class="ruby-identifier">exit</span>
91:         <span class="ruby-keyword kw">end</span>
92:         
93:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:scripts</span>] = <span class="ruby-identifier">args</span>
94:         <span class="ruby-identifier">options</span>
95:       <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Server-XSendfile">
    		  <a href="#class-Camping-Server-XSendfile">
    		  Class
    		  Camping::Server::XSendfile
    		  
    		    &lt;
            
              Object
            
          
          </a>
    		</h2>
    		
    		<div class="mod">
  			  
  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000046">
    		    <a href="#M000046">
    		    Public Class method:
    		    <strong>::new(app)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 238</span>
238:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">app</span>)
239:         <span class="ruby-ivar">@app</span> = <span class="ruby-identifier">app</span>
240:       <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000047">
    		    <a href="#M000047">
    		    Public Instance method:
    		    <strong>#call(env)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 242</span>
242:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
243:         <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span> = <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
244:         
245:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span> = <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/X-Sendfile/i</span>).<span class="ruby-identifier">first</span>
246:           <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">key</span>]
247:           <span class="ruby-identifier">content</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>,<span class="ruby-value str">'rb'</span>) { <span class="ruby-operator">|</span> <span class="ruby-identifier">io</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>}
248:           <span class="ruby-identifier">headers</span>[<span class="ruby-value str">'Content-Length'</span>] = <span class="ruby-identifier">size</span>(<span class="ruby-identifier">content</span>).<span class="ruby-identifier">to_s</span>
249:           <span class="ruby-identifier">body</span> = [<span class="ruby-identifier">content</span>]
250:         <span class="ruby-keyword kw">end</span>
251:         
252:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>
253:       <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000048">
    		    <a href="#M000048">
    		    Public Instance method:
    		    <strong>#size(str)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 256</span>
256:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">size</span>(<span class="ruby-identifier">str</span>)
257:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">bytesize</span>
258:         <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
    		  <h4 class="ruled" id="M000049">
    		    <a href="#M000049">
    		    Public Instance method:
    		    <strong>#size(str)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
     <span class="ruby-comment cmt"># File lib/camping/server.rb, line 260</span>
260:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">size</span>(<span class="ruby-identifier">str</span>)
261:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">size</span>
262:         <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Session">
    		  <a href="#class-Camping-Session">
    		  Module
    		  Camping::Session
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <h3>Getting Started</h3>
<p>
To get sessions working for your application:
</p>
<ol>
<li><tt>require 'camping/session'</tt>

</li>
<li>Define a secret (and keep it secret): <tt>set :secret,
&quot;SECRET!&quot;</tt>

</li>
<li>Mixin the module: <tt>include Camping::Session</tt>

</li>
<li>Throughout your application, use the <tt>@state</tt> var like a hash to
store your application&#8217;s data.

</li>
</ol>
<pre>
  require 'camping/session'    # 1

  module Nuts
    set :secret, &quot;Oh yeah!&quot;    # 2
    include Camping::Session   # 3
  end
</pre>
<h3>Other backends</h3>
<p>
<a href="#class-Camping">Camping</a> only ships with
session-cookies. However, the <tt>@state</tt> variable is simply a shortcut
for <tt>@<a href="http://'rack.session'">env</a></tt>. Therefore you can
also use any middleware which sets this variable:
</p>
<pre>
  module Nuts
    use Rack::Session::Memcache
  end
</pre>

  			  
    		  <h3>Methods</h3>
    		
    		  <h4 class="ruled" id="M000036">
    		    <a href="#M000036">
    		    Public Class method:
    		    <strong>::included(app)</strong>
    		    <img src="./images/permalink.gif">
    		    </a>
    		  </h4>
    		  <div class="method">
    		    
            <p class="source-link">[ <a href="#">show source</a> ]</p>
<pre class="sourcecode">
    <span class="ruby-comment cmt"># File lib/camping/session.rb, line 28</span>
28:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">included</span>(<span class="ruby-identifier">app</span>)
29:       <span class="ruby-identifier">key</span>    = <span class="ruby-node">&quot;#{app}.state&quot;</span>.<span class="ruby-identifier">downcase</span>
30:       <span class="ruby-identifier">secret</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:secret</span>] <span class="ruby-operator">||</span> [<span class="ruby-keyword kw">__FILE__</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-keyword kw">__FILE__</span>)].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;:&quot;</span>)
31:       
32:       <span class="ruby-identifier">app</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">Cookie</span>, <span class="ruby-identifier">:key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:secret</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">secret</span>
33:     <span class="ruby-keyword kw">end</span></pre>
          </div>
    		
        </div>
       
    		<h2 id="class-Camping-Views">
    		  <a href="#class-Camping-Views">
    		  Module
    		  Camping::Views
    		  
          </a>
    		</h2>
    		
    		<div class="mod">
  			  <p>
<a href="#class-Camping-Views">Views</a> is an empty module for
storing methods which create HTML. The HTML is described using the Markaby
language.
</p>
<h3>Defining and calling templates</h3>
<p>
Templates are simply Ruby methods with Markaby inside:
</p>
<pre>
  module Blog::Views
    def index
      p &quot;Welcome to my blog&quot;
    end

    def show
      h1 @post.title
      self &lt;&lt; @post.content
    end
  end
</pre>
<p>
In your controllers you just call <tt>render :template_name</tt> which will
invoke the template. The views and controllers will share instance
variables (as you can see above).
</p>
<h3>Using the layout method</h3>
<p>
If your <a href="#class-Camping-Views">Views</a> module has a
<tt>layout</tt> method defined, it will be called with a block which will
insert content from your view:
</p>
<pre>
  module Blog::Views
    def layout
      html do
        head { title &quot;My Blog &quot;}
        body { self &lt;&lt; yield }
      end
    end
  end
</pre>

  			  
    		  <h3>Methods</h3>
    		
        </div>
      
      </div>
    </div>
  </div>
</body>
</html>